<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mapa Leaflet con Stormglass</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <link rel="stylesheet" href="../CSS/MapStyles.css"/>
    <link rel="stylesheet" href="../CSS/ViewMoreWindowStyle.css"/>
</head>
<body>

<div id="map"></div>

<div class="popup" style="display: none;">
    <div class="popup-content">
        <button class="close-btn" onclick="closePopup()">X</button>
        <div class="popup-header">
            <h2 id="popup-title">Información de la zona</h2>
        </div>
        <div class="popup-body">
            <img id="popup-image" src="" alt="Imagen de la zona seleccionada" class="popup-image" style="display: none;">
            <p><strong>Nombre de la isla:</strong> <span id="popup-island">-</span></p>
            <p><strong>Zona:</strong> <span id="popup-zone">-</span></p>
            <p><strong>Información adicional:</strong> <span id="popup-info">-</span></p>
            <table class="weather-table">
                <thead>
                <tr>
                    <th>Temperatura</th>
                    <th>Viento</th>
                    <th>Humedad</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td id="temperature-cell">
                        <img id="iconImg" src="../../icons/sunny-clearCloud.png" class="weather-icon">
                        <span id="temperature"></span>
                    </td>
                    <td><span id="wind"></span></td>
                    <td><span id="humidity"></span></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="popup-footer">
            <a id="popup-link" href="#" class="more-info">Ver más</a>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
<script src="../JS/map.js"></script>

<script>
    function closePopup() {
        document.querySelector('.popup').style.display = 'none';
    }
    getPrincipalData();

    function getPrincipalData() {
        const jsonURL = "https://api.weatherapi.com/v1/forecast.json?key=8eff48f079e44211b52124000251703&q=28.771831683485686,%20-17.750202868741685&days=7&aqi=no&alerts=no";
        fetch (jsonURL, {
            method: "GET",
            headers: {'Content-Type': 'application/json'}
        })
            .then(response => response.json())
            .then(json => {
                const icon = json.current.condition.icon;
                const temp = json.current.temp_c;
                const wind = json.current.wind_kph;
                const humidity = json.current.humidity;
                document.getElementById("temperature").innerHTML = `${temp}ºC`;
                document.getElementById("wind").innerHTML = `${wind}km/h`;
                document.getElementById("humidity").innerHTML = `${humidity}%`;
                document.getElementById("iconImg").src = icon;
            })
    }
</script>
</body>
</html>
